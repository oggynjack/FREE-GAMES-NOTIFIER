<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Epic Free Games Notifier</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Modern Input Styles */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="time"],
        select {
            width: 100%;
            padding: 0.85rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(0, 255, 159, 0.2);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            outline: none;
        }

        input:focus,
        select:focus {
            border-color: var(--primary);
            background: rgba(0, 255, 159, 0.05);
            box-shadow: 0 0 20px rgba(0, 255, 159, 0.2);
        }

        input::placeholder {
            color: var(--text-muted);
        }

        /* Custom Modal */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border: 2px solid rgba(0, 255, 159, 0.3);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, -40%);
                opacity: 0;
            }

            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 255, 159, 0.2);
        }

        .modal-header i {
            font-size: 2rem;
        }

        .modal-header.success i {
            color: var(--success);
        }

        .modal-header.error i {
            color: var(--error);
        }

        .modal-header.warning i {
            color: #ffc107;
        }

        .modal-body {
            margin: 1.5rem 0;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #0a0e27;
        }

        .modal-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 159, 0.3);
            color: var(--text);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 159, 0.3);
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .control-section {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(0, 255, 159, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .control-section:hover {
            border-color: rgba(0, 255, 159, 0.4);
            transform: translateY(-2px);
        }

        .control-section.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 255, 159, 0.2);
        }

        .section-header h3 {
            color: var(--primary);
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 255, 159, 0.5);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        .section-save-btn {
            width: 100%;
            margin-top: 1rem;
            padding: 0.75rem;
            font-size: 0.95rem;
        }

        @media (max-width: 1024px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div id="particles"></div>

    <!-- Custom Modal -->
    <div id="customModal" class="custom-modal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">
                <i class="fas fa-info-circle"></i>
                <h2 id="modalTitle">Message</h2>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-actions" id="modalActions"></div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1><i class="fas fa-user-shield"></i> Admin Control Panel</h1>
            <p>Complete system management and configuration</p>
            <div style="margin-top: 1rem;">
                <button onclick="logout()"
                    style="background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <div class="admin-grid">
            <!-- Left Column -->
            <div>
                <!-- Database Settings -->
                <div class="control-section" id="dbSection">
                    <div class="section-header">
                        <h3><i class="fas fa-database"></i> Database Configuration</h3>
                        <div class="switch-container">
                            <span style="font-size: 0.85rem; color: var(--text-muted);">Active</span>
                            <label class="switch">
                                <input type="checkbox" id="enableDb" checked
                                    onchange="toggleSection('dbSection', this.checked, 'db_enabled')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Storage Mode</label>
                        <select id="dbMode" onchange="handleDbModeChange()">
                            <option value="json">JSON Files (Local)</option>
                            <option value="mongodb">MongoDB Only</option>
                            <option value="hybrid">Hybrid (JSON + MongoDB)</option>
                        </select>
                    </div>

                    <div class="form-group" id="mongodbUrlGroup" style="display: none;">
                        <label><i class="fas fa-link"></i> MongoDB Connection URL</label>
                        <input type="text" id="mongodbUrl" placeholder="mongodb://localhost:27017/dbname">
                    </div>

                    <button onclick="saveDbSettings()" class="uiverse-btn section-save-btn">
                        <i class="fas fa-save"></i> Save Database Settings
                    </button>
                </div>

                <!-- Notification Settings -->
                <div class="control-section" id="notificationSection">
                    <div class="section-header">
                        <h3><i class="fas fa-bell"></i> Notification Settings</h3>
                        <div class="switch-container">
                            <span style="font-size: 0.85rem; color: var(--text-muted);">Enabled</span>
                            <label class="switch">
                                <input type="checkbox" id="enableNotifications" checked
                                    onchange="toggleSection('notificationSection', this.checked, 'enable_notifications')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Email Recipients</label>
                        <div id="emailList"></div>
                        <div class="email-input-group">
                            <input type="email" id="newEmail" placeholder="Add email address">
                            <button class="btn-small" onclick="addEmail()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Check Frequency</label>
                        <select id="checkFrequency">
                            <option value="manual">Manual Only</option>
                            <option value="hourly">Every Hour</option>
                            <option value="6hours">Every 6 Hours</option>
                            <option value="12hours">Every 12 Hours</option>
                            <option value="daily">Daily</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-calendar-check"></i> Preferred Check Time</label>
                        <input type="time" id="preferredTime" value="09:00">
                    </div>

                    <button onclick="saveNotificationSettings()" class="uiverse-btn section-save-btn">
                        <i class="fas fa-save"></i> Save Notification Settings
                    </button>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Game Filtering -->
                <div class="control-section" id="filteringSection">
                    <div class="section-header">
                        <h3><i class="fas fa-filter"></i> Game Filtering</h3>
                        <div class="switch-container">
                            <span style="font-size: 0.85rem; color: var(--text-muted);">Enabled</span>
                            <label class="switch">
                                <input type="checkbox" id="enableFiltering" checked
                                    onchange="toggleSection('filteringSection', this.checked, 'filtering_enabled')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-tag"></i> Price Threshold (INR)</label>
                        <input type="number" id="priceThreshold" value="{{ settings.get('price_threshold', 500) }}"
                            min="0">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-globe"></i> Currency</label>
                        <select id="currency">
                            <option value="INR">INR (₹)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                            <option value="GBP">GBP (£)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 1rem; justify-content: space-between;">
                            <span><i class="fas fa-gift"></i> Only Truly Free Games</span>
                            <label class="switch">
                                <input type="checkbox" id="onlyFreeGames">
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 1rem; justify-content: space-between;">
                            <span><i class="fas fa-ban"></i> Exclude DLC & Add-ons</span>
                            <label class="switch">
                                <input type="checkbox" id="excludeDLC" checked>
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 1rem; justify-content: space-between;">
                            <span><i class="fas fa-vial"></i> Exclude Beta/Early Access</span>
                            <label class="switch">
                                <input type="checkbox" id="excludeBeta" checked>
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>

                    <button onclick="saveFilteringSettings()" class="uiverse-btn section-save-btn">
                        <i class="fas fa-save"></i> Save Filtering Settings
                    </button>
                </div>

                <!-- System Controls -->
                <div class="control-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cogs"></i> System Controls</h3>
                    </div>

                    <button onclick="runScraper(false)" id="runBtn" class="uiverse-btn uiverse-btn-run"
                        style="width: 100%; margin-bottom: 0.5rem;">
                        <i class="fas fa-rocket"></i> Run Notifier Now
                    </button>

                    <button onclick="runScraper(true)" id="forceBtn" class="uiverse-btn"
                        style="width: 100%; margin-bottom: 1rem; background: linear-gradient(135deg, #ffc107, #ff9800);">
                        <i class="fas fa-paper-plane"></i> Force Send Notifications
                    </button>

                    <button onclick="clearHistoryWithConfirm()" class="btn-small"
                        style="width: 100%; margin-bottom: 0.5rem; background: rgba(255, 56, 100, 0.2); border: 1px solid var(--error); color: var(--error);">
                        <i class="fas fa-trash"></i> Clear Games History
                    </button>

                    <button onclick="window.location.href='/games'" class="btn-small" style="width: 100%;">
                        <i class="fas fa-eye"></i> View Games Timeline
                    </button>
                </div>

                <!-- Console Output -->
                <div class="control-section">
                    <div class="section-header">
                        <h3><i class="fas fa-terminal"></i> Console Output</h3>
                    </div>
                    <div class="console-box" id="consoleOutput">
                        <div style="color: var(--text-muted);"><i class="fas fa-info-circle"></i> Ready to check for
                            free games...</div>
                    </div>

                    <div class="stats-container">
                        <div class="stat-box">
                            <label><i class="fas fa-tasks"></i> Processed</label>
                            <span id="countProcessed">0</span>
                        </div>
                        <div class="stat-box">
                            <label><i class="fas fa-trophy"></i> Found</label>
                            <span id="countTotal">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Found Games Section -->
        <section class="card" style="margin-top: 2rem;">
            <h2><i class="fas fa-gamepad"></i> Found Games</h2>
            <div class="found-games-grid" id="foundGamesList"></div>
        </section>
    </div>

    <script>
        const initialEmails = {{ settings.get('emails', []) | tojson }};
        let emails = initialEmails || [];
        let allFoundGames = [];

        // Custom Modal Functions
        function showModal(title, message, type = 'info', buttons = null) {
            const modal = document.getElementById('customModal');
            const modalHeader = document.getElementById('modalHeader');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalActions = document.getElementById('modalActions');

            modalTitle.textContent = title;
            modalBody.innerHTML = message;

            modalHeader.className = `modal-header ${type}`;
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-triangle',
                'warning': 'fa-exclamation-circle',
                'info': 'fa-info-circle'
            };
            modalHeader.querySelector('i').className = `fas ${icons[type] || icons.info}`;

            modalActions.innerHTML = '';
            if (buttons) {
                buttons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = `modal-btn ${btn.primary ? 'modal-btn-primary' : 'modal-btn-secondary'}`;
                    button.textContent = btn.text;
                    button.onclick = () => {
                        hideModal();
                        if (btn.onclick) btn.onclick();
                    };
                    modalActions.appendChild(button);
                });
            } else {
                const okButton = document.createElement('button');
                okButton.className = 'modal-btn modal-btn-primary';
                okButton.textContent = 'OK';
                okButton.onclick = hideModal;
                modalActions.appendChild(okButton);
            }

            modal.style.display = 'block';
        }

        function hideModal() {
            document.getElementById('customModal').style.display = 'none';
        }

        function customAlert(message, type = 'info') {
            return new Promise(resolve => {
                showModal('Notification', message, type, [
                    { text: 'OK', primary: true, onclick: resolve }
                ]);
            });
        }

        function customConfirm(message) {
            return new Promise((resolve) => {
                showModal('Confirm', message, 'warning', [
                    { text: 'Cancel', primary: false, onclick: () => resolve(false) },
                    { text: 'Confirm', primary: true, onclick: () => resolve(true) }
                ]);
            });
        }

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;

            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            renderEmails();
            loadSettings();
        });

        function logout() {
            window.location.href = '/logout';
        }

        function toggleSection(sectionId, enabled, settingKey) {
            const section = document.getElementById(sectionId);
            if (enabled) {
                section.classList.remove('disabled');
            } else {
                section.classList.add('disabled');
            }

            // Save toggle state immediately
            if (settingKey) {
                saveSetting(settingKey, enabled);
            }
        }

        async function saveSetting(key, value) {
            try {
                const currentSettings = await fetch('/api/settings').then(r => r.json());
                currentSettings[key] = value;
                await fetch('/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentSettings)
                });
            } catch (error) {
                console.error('Error saving setting:', error);
            }
        }

        function handleDbModeChange() {
            const mode = document.getElementById('dbMode').value;
            const mongoUrlGroup = document.getElementById('mongodbUrlGroup');
            mongoUrlGroup.style.display = (mode === 'mongodb' || mode === 'hybrid') ? 'block' : 'none';
        }

        async function saveDbSettings() {
            const settings = {
                db_mode: document.getElementById('dbMode').value,
                db_mongodb_url: document.getElementById('mongodbUrl').value,
                db_enabled: document.getElementById('enableDb').checked
            };
            await saveSection(settings, 'Database settings saved!');
        }

        async function saveNotificationSettings() {
            const settings = {
                emails: emails,
                enable_notifications: document.getElementById('enableNotifications').checked,
                check_frequency: document.getElementById('checkFrequency').value,
                preferred_time: document.getElementById('preferredTime').value
            };
            await saveSection(settings, 'Notification settings saved!');
        }

        async function saveFilteringSettings() {
            const settings = {
                price_threshold: parseInt(document.getElementById('priceThreshold').value),
                currency: document.getElementById('currency').value,
                only_free_games: document.getElementById('onlyFreeGames').checked,
                exclude_dlc: document.getElementById('excludeDLC').checked,
                exclude_beta: document.getElementById('excludeBeta').checked,
                filtering_enabled: document.getElementById('enableFiltering').checked
            };
            await saveSection(settings, 'Filtering settings saved!');
        }

        async function saveSection(sectionSettings, successMessage) {
            try {
                const currentSettings = await fetch('/api/settings').then(r => r.json());
                const mergedSettings = { ...currentSettings, ...sectionSettings };

                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(mergedSettings)
                });

                if (response.ok) {
                    await customAlert(successMessage, 'success');
                } else {
                    throw new Error('Save failed');
                }
            } catch (error) {
                await customAlert('Error saving settings', 'error');
            }
        }

        function renderEmails() {
            const list = document.getElementById('emailList');
            list.innerHTML = '';
            emails.forEach((email, index) => {
                const item = document.createElement('div');
                item.className = 'email-item';
                item.innerHTML = `
                    <span><i class="fas fa-envelope"></i> ${email}</span>
                    <button class="remove-email" onclick="removeEmail(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                list.appendChild(item);
            });
        }

        function addEmail() {
            const input = document.getElementById('newEmail');
            const email = input.value.trim();
            if (email && !emails.includes(email)) {
                emails.push(email);
                renderEmails();
                input.value = '';
            }
        }

        function removeEmail(index) {
            emails.splice(index, 1);
            renderEmails();
        }

        async function loadSettings() {
            try {
                const data = await fetch('/api/settings').then(r => r.json());

                // Load values
                document.getElementById('dbMode').value = data.db_mode || 'json';
                document.getElementById('mongodbUrl').value = data.db_mongodb_url || '';
                document.getElementById('priceThreshold').value = data.price_threshold || 500;
                document.getElementById('currency').value = data.currency || 'INR';
                document.getElementById('checkFrequency').value = data.check_frequency || 'manual';
                document.getElementById('preferredTime').value = data.preferred_time || '09:00';

                // Load toggle states
                const enableDb = data.db_enabled !== undefined ? data.db_enabled : true;
                const enableNotifications = data.enable_notifications !== undefined ? data.enable_notifications : true;
                const enableFiltering = data.filtering_enabled !== undefined ? data.filtering_enabled : true;

                document.getElementById('enableDb').checked = enableDb;
                document.getElementById('enableNotifications').checked = enableNotifications;
                document.getElementById('enableFiltering').checked = enableFiltering;
                document.getElementById('onlyFreeGames').checked = data.only_free_games || false;
                document.getElementById('excludeDLC').checked = data.exclude_dlc !== undefined ? data.exclude_dlc : true;
                document.getElementById('excludeBeta').checked = data.exclude_beta !== undefined ? data.exclude_beta : true;

                // Apply toggle states
                toggleSection('dbSection', enableDb);
                toggleSection('notificationSection', enableNotifications);
                toggleSection('filteringSection', enableFiltering);

                handleDbModeChange();
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function clearHistoryWithConfirm() {
            const confirmed = await customConfirm('Are you sure you want to clear all games history? This action cannot be undone.');
            if (confirmed) {
                await customAlert('History cleared!', 'success');
            }
        }

        async function runScraper(forceNotify = false) {
            const consoleOutput = document.getElementById('consoleOutput');
            const runBtn = document.getElementById('runBtn');
            const forceBtn = document.getElementById('forceBtn');

            runBtn.disabled = true;
            forceBtn.disabled = true;
            runBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Running...';
            consoleOutput.innerHTML = '<div class="log-info"><i class="fas fa-sync fa-spin"></i> Starting...</div>';
            allFoundGames = [];

            try {
                const url = forceNotify ? '/api/stream_run?force=true' : '/api/stream_run';
                const eventSource = new EventSource(url);

                eventSource.onmessage = function (event) {
                    const data = JSON.parse(event.data);

                    if (data.type === 'log') {
                        const logClass = `log-${data.level || 'info'}`;
                        consoleOutput.innerHTML += `<div class="${logClass}">${data.message}</div>`;
                        consoleOutput.scrollTop = consoleOutput.scrollHeight;
                    }

                    if (data.type === 'found') {
                        allFoundGames.push(data.game);
                        renderGames(allFoundGames);
                    }

                    if (data.type === 'progress') {
                        document.getElementById('countProcessed').textContent = data.processed || 0;
                        document.getElementById('countTotal').textContent = data.total || 0;
                    }

                    if (data.type === 'complete') {
                        eventSource.close();
                        runBtn.disabled = false;
                        forceBtn.disabled = false;
                        runBtn.innerHTML = '<i class="fas fa-rocket"></i> Run Notifier Now';
                        consoleOutput.innerHTML += '<div class="log-success"><i class="fas fa-check"></i> Complete!</div>';
                        customAlert('Scraper completed successfully!', 'success');
                    }
                };

                eventSource.onerror = function (error) {
                    console.error('EventSource error:', error);
                    eventSource.close();
                    runBtn.disabled = false;
                    forceBtn.disabled = false;
                    runBtn.innerHTML = '<i class="fas fa-rocket"></i> Run Notifier Now';
                    consoleOutput.innerHTML += '<div class="log-error"><i class="fas fa-times"></i> Connection error</div>';
                    customAlert('Connection error. Please try again.', 'error');
                };
            } catch (error) {
                console.error('Error starting scraper:', error);
                runBtn.disabled = false;
                forceBtn.disabled = false;
                runBtn.innerHTML = '<i class="fas fa-rocket"></i> Run Notifier Now';
                customAlert('Error starting scraper', 'error');
            }
        }

        function renderGames(games) {
            const container = document.getElementById('foundGamesList');
            if (games.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No games found yet</p>';
                return;
            }
            container.innerHTML = games.map(game => `
                <a href="${game.url}" target="_blank" style="text-decoration: none;">
                    <div class="game-card-small">
                        <img src="${game.image_url}" alt="${game.title}" onerror="this.src='https://via.placeholder.com/400x600?text=No+Image'">
                        <div class="info">
                            <h4>${game.title}</h4>
                            <span class="price-tag">${game.is_free ? 'FREE' : (game.discounted_price || 'FREE')}</span>
                        </div>
                    </div>
                </a>
            `).join('');
        }
    </script>
</body>

</html>